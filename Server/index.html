<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SSO</title>
</head>
<body>
  <!-- JS -->
  <script>
    // 初始化
    function init () {
      // 获取链接参数
      var query = GetQuery()
      // 获取 type
      var type = query.type || 'check'
      // 获取 token
      var token = query.token || ''
      // 判断状态
      if (type === 'login') {
        // 存储
        localStorage.setItem('token', token)
      } else if (type === 'logout') {
        // 移除
        token = ''
        localStorage.setItem('token', token)
      } else { // check
        // 获取
        token = localStorage.getItem('token') || ''
      }
      // 参数
      var params = {
        sso: 1,
        type: type,
        token: token
      }
      // 发送参数
      window.parent.postMessage(params, '*')
      // window.postMessage(params, '*')
    }
    // 调用初始化
    init()
    // 解析链接参数
    function GetQuery () {
      // 获取 url 中 '?' 符后的字串(包括问号)
      var url = decodeURI(location.search)
      var query = {}
      if (url.indexOf("?") != -1) {
        const str = url.substr(1)
        const pairs = str.split("&")
        for(var i = 0; i < pairs.length; i ++) {
          const pair = pairs[i].split("=")
          query[pair[0]] = pair[1]
        }
      }
      return query
    }
  </script>
</body>
</html>